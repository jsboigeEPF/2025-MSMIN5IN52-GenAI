<!DOCTYPE html>
<html>
<head>
    <title>Rapport d'évaluation de biais</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1, h2, h3 { color: #333; }
        .section { margin-bottom: 30px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .score-high { color: red; font-weight: bold; }
        .score-medium { color: orange; }
        .score-low { color: green; }
        .model-section { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; }
        .summary-box {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .summary-box h3 { margin-top: 0; }
    </style>
</head>
<body>
    <h1>Rapport d'évaluation de biais</h1>
    
    <div class="summary-box">
        <h3>Résumé</h3>
        <p><strong>Date de génération:</strong> {{ date }}</p>
        <p><strong>Nombre de modèles évalués:</strong> {{ models|length }}</p>
        <p><strong>Meilleur modèle:</strong> {{ best_model.model_name }} (score: {{ "%.3f"|format(best_model.average_bias_score) }})</p>
        <p><strong>Pire modèle:</strong> {{ worst_model.model_name }} (score: {{ "%.3f"|format(worst_model.average_bias_score) }})</p>
    </div>

    <div class="section">
        <h2>Résultats détaillés par modèle</h2>
        <table>
            <tr>
                <th>Modèle</th>
                <th>Biais de genre</th>
                <th>Biais racial</th>
                <th>Stéréotypes</th>
                <th>Toxicité</th>
                <th>Score global</th>
            </tr>
            {% for model_name, results in models.items() %}
            <tr>
                <td>{{ model_name }}</td>
                <td class="{{ get_score_class(results.get('gender_bias', {}).get('bias_score', 0)) }}">
                    {{ "%.3f"|format(results.get('gender_bias', {}).get('bias_score', 0)) }}
                </td>
                <td class="{{ get_score_class(results.get('racial_bias', {}).get('bias_score', 0)) }}">
                    {{ "%.3f"|format(results.get('racial_bias', {}).get('bias_score', 0)) }}
                </td>
                <td class="{{ get_score_class(results.get('stereotype_bias', {}).get('bias_score', 0)) }}">
                    {{ "%.3f"|format(results.get('stereotype_bias', {}).get('bias_score', 0)) }}
                </td>
                <td class="{{ get_score_class(results.get('toxicity', {}).get('bias_score', 0)) }}">
                    {{ "%.3f"|format(results.get('toxicity', {}).get('bias_score', 0)) }}
                </td>
                <td class="{{ get_score_class(results.get('overall_bias_score', 0)) }}">
                    {{ "%.3f"|format(results.get('overall_bias_score', 0)) }}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="section">
        <h2>Analyses détaillées</h2>
        {% for model_name, results in models.items() %}
        <div class="model-section">
            <h3>{{ model_name }}</h3>
            {% for bias_type, result in results.items() %}
            {% if isinstance(result, dict) and 'bias_score' in result %}
            <h4>{{ bias_type.replace('_', ' ').title() }}</h4>
            <p><strong>Score de biais:</strong> {{ "%.3f"|format(result['bias_score']) }}</p>
            {% if 'results' in result %}
            <p><strong>Détails:</strong> {{ result['results'] }}</p>
            {% endif %}
            {% if 'scores' in result %}
            <p><strong>Répartition:</strong> 
            {% for category, score in result['scores'].items() %}
                {{ category }}: {{ "%.3f"|format(score) }}; 
            {% endfor %}
            </p>
            {% endif %}
            {% endif %}
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</body>
</html>