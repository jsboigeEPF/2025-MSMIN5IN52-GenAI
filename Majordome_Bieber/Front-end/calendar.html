<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendrier | Justin Bieber</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css"> <!-- LIEN VERS VOTRE NOUVEAU STYLE.CSS -->
</head>
<body class="body-calendar"> <!-- Classe spécifique pour cette page -->
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 fw-bold">Calendrier</h1>
        <a href="index.html" class="btn btn-outline-primary">
            <i class="bi bi-arrow-left me-2"></i>Retour
        </a>
    </div>

    <!-- Formulaire de création d'événement -->
    <form id="event-form" class="mb-4 p-4 card"> <!-- Ajout de la classe card -->
        <h5 class="fw-semibold mb-3">Créer un nouvel événement</h5>
        <div class="row g-2">
            <div class="col-md-3">
                <input type="text" class="form-control" id="summary" placeholder="Titre de l'événement" required>
            </div>
            <div class="col-md-2">
                <input type="date" class="form-control" id="date" required>
            </div>
            <div class="col-md-2">
                <input type="time" class="form-control" id="start_time" required>
            </div>
            <div class="col-md-2">
                <input type="time" class="form-control" id="end_time" required>
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" id="location" placeholder="Lieu (optionnel)">
            </div>
        </div>
        <button type="submit" class="btn btn-primary mt-3">Créer l'événement</button>
    </form>

    <div class="row">
        <div class="col-lg-8" id="events-container">
            <!-- Les événements seront injectés ici -->
            <p class="text-muted text-center py-5">Chargement des événements...</p>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function loadEvents() {
    fetch("http://localhost:5000/api/calendar/events")
        .then(response => response.json())
        .then(data => {
            const events = data.events || [];
            const container = document.getElementById("events-container");
            container.innerHTML = "";

            if (events.length === 0) {
                container.innerHTML = "<p class='text-muted text-center'>Aucun événement à venir.</p>";
            }

            events.forEach(event => {
                const div = document.createElement("div");
                div.className = "calendar-event p-3 shadow-sm mb-3";
                div.innerHTML = `
                    <h5 class="fw-semibold mb-2">${event.summary || "Sans titre"}</h5>
                    <p class="text-muted mb-2"><i class="bi bi-clock me-2"></i>${event.start}</p>
                    <p class="text-muted mb-0"><i class="bi bi-geo-alt me-2"></i>${event.location || "Lieu non précisé"}</p>
                `;
                container.appendChild(div);
            });
        })
        .catch(err => {
            const container = document.getElementById("events-container");
            container.innerHTML = "<p class='text-danger text-center'>Erreur lors du chargement des événements.</p>";
        });
}

document.addEventListener("DOMContentLoaded", function() {
    loadEvents();

    document.getElementById("event-form").addEventListener("submit", function(e) {
        e.preventDefault();
        const summary = document.getElementById("summary").value;
        const date = document.getElementById("date").value;
        const start_time = document.getElementById("start_time").value;
        const end_time = document.getElementById("end_time").value;
        const location = document.getElementById("location").value;

        fetch("http://localhost:5000/api/calendar/events", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                summary,
                date,
                start_time,
                end_time,
                location
            })
        })
        .then(response => response.json())
        .then(data => {
            if(data.success){
                alert("Événement créé !");
                loadEvents();
                document.getElementById("event-form").reset();
            } else {
                alert("Erreur : " + (data.error || "Impossible de créer l'événement"));
            }
        })
        .catch(() => alert("Erreur lors de la création de l'événement."));
    });
});
</script>
</body>
</html>